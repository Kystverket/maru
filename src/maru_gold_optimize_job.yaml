# yaml-language-server: $schema=bundle_config_schema.json
resources:
  jobs:
    maru-gold-optimize-job:
      name: "[${bundle.target}] MarU gold optimize"
      run_as:
        service_principal_name: ${var.service_principal_id}
      tasks:
        - task_key: maru-optimize
          task_type: notebook
          description: "MarU gold optimize"
          notebook_task:
            notebook_path: ./optimize_tables.py
            source: WORKSPACE
          job_cluster_key: maru_gold_optimize_cluster
      job_clusters:
        - job_cluster_key: maru_gold_optimize_cluster
          new_cluster:
              cluster_name: ""
              spark_version: 13.3.x-scala2.12
              azure_attributes:
                first_on_demand: 1
                availability: SPOT_WITH_FALLBACK_AZURE
                spot_bid_max_price: -1
              node_type_id: Standard_L8as_v3
              driver_node_type_id: Standard_DS3_v2
              spark_env_vars:
                ENVIRONMENT: ${bundle.target}
              custom_tags:
                costcenter: dataplatform
                product: maru
                job: maru-gold-optimize
              enable_elastic_disk: true
              data_security_mode: USER_ISOLATION
              runtime_engine: PHOTON
              autoscale:
                min_workers: 1
                max_workers: 6
