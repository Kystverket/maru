# yaml-language-server: $schema=bundle_config_schema.json
resources:
  jobs:
    maru-gold-job:
      name: "[${bundle.target}] MarU gold"
      run_as:
        service_principal_name: ${var.service_principal_id}
      tasks:
        - task_key: vessel
          task_type: notebook
          description: "MarU Vessel"
          notebook_task:
            notebook_path: ./vessel/vessel_gold/vessel.py
            source: WORKSPACE
          job_cluster_key: maru_gold_cluster
        - task_key: maru
          task_type: notebook
          description: "MarU gold"
          notebook_task:
            notebook_path: ./maru.py
            base_parameters:
              date_variables: 2023-10-01
            source: WORKSPACE
          job_cluster_key: maru_gold_cluster
          depends_on:
            - task_key: vessel
        - task_key: maru-grouped
          task_type: notebook
          description: "MarU gold grouped"
          notebook_task:
            notebook_path: ./maru_grouped.py
          job_cluster_key: maru_gold_cluster
          depends_on:
            - task_key: maru
        - task_key: maru-optimize
          task_type: notebook
          description: "MarU gold optimize"
          notebook_task:
            notebook_path: ./optimize_tables.py
            source: WORKSPACE
          job_cluster_key: maru_gold_cluster
          depends_on:
            - task_key: maru-grouped
      job_clusters:
        - job_cluster_key: maru_gold_cluster
          new_cluster:
              cluster_name: ""
              spark_version: 13.3.x-scala2.12
              azure_attributes:
                first_on_demand: 1
                availability: SPOT_WITH_FALLBACK_AZURE
                spot_bid_max_price: -1
              node_type_id: Standard_E8d_v4
              driver_node_type_id: Standard_E8d_v4
              spark_env_vars:
                ENVIRONMENT: ${bundle.target}
              custom_tags:
                costcenter: dataplatform
                product: maru
                job: maru-gold
              enable_elastic_disk: true
              data_security_mode: USER_ISOLATION
              runtime_engine: PHOTON
              autoscale:
                min_workers: 1
                max_workers: 8
    maru-gold-vessel-job:
      name: "[${bundle.target}] MarU gold vessel"
      run_as:
        service_principal_name: ${var.service_principal_id}
      tasks:
        - task_key: vessel
          task_type: notebook
          description: "MarU Vessel"
          notebook_task:
            notebook_path: ./vessel/vessel_gold/vessel.py
            source: WORKSPACE
          job_cluster_key: maru_gold_vessel_cluster
      job_clusters:
        - job_cluster_key: maru_gold_vessel_cluster
          new_cluster:
              cluster_name: ""
              spark_version: 13.3.x-scala2.12
              azure_attributes:
                first_on_demand: 1
                availability: SPOT_WITH_FALLBACK_AZURE
                spot_bid_max_price: -1
              node_type_id: Standard_E8d_v4
              driver_node_type_id: Standard_E8d_v4
              spark_env_vars:
                ENVIRONMENT: ${bundle.target}
              custom_tags:
                costcenter: dataplatform
                product: maru
                job: maru-gold-vessel
              enable_elastic_disk: true
              data_security_mode: USER_ISOLATION
              autoscale:
                min_workers: 1
                max_workers: 1
